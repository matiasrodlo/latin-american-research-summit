!function(r){"use strict";"object"!=typeof qodefFramework&&(window.qodefFramework={}),qodefFramework.scroll=0,qodefFramework.windowWidth=r(window).width(),qodefFramework.windowHeight=r(window).height(),r(document).ready(function(){l.init()});var l={init:function(){this.mainForm=r("#qodef-bulk-start"),this.mainFormParams=void 0!==this.mainForm.data("params")?this.mainForm.data("params"):{},this.allOptions=r('input[type="radio"][name="bulk_option[]"], input[type="radio"][name="bulk_folders_option[]"]'),this.option=r('input[type="radio"][name="bulk_option[]"]'),this.checkedOption=r('input[type="radio"][name="bulk_option[]"]:checked'),this.optionValue=this.checkedOption.length?this.checkedOption.val():"none",this.forceOptimization=r('input[type="checkbox"][name="bulk_force_optimization"]'),this.ids=this.mainFormParams.media[this.optionValue].ids,this.idsCount=this.mainFormParams.media[this.optionValue].count,this.foldersOption=r('input[type="radio"][name="bulk_folders_option[]"]'),this.checkedFoldersOption=r('input[type="radio"][name="bulk_folders_option[]"]:checked'),this.foldersOptionValue=this.checkedFoldersOption.length?this.checkedFoldersOption.val():"none",this.foldersForceOptimization=r('input[type="checkbox"][name="bulk_folders_force_optimization"]'),this.paths=this.mainFormParams.folders[this.foldersOptionValue].paths,this.pathsCount=this.mainFormParams.folders[this.foldersOptionValue].count,this.mainFormSubmit=r("#qodef-bulk-start").find('input[type="submit"]'),this.loading=r("#qodef-bulk-loading .qodef-spinner-loading"),this.message=r("#qodef-bulk-loading .qodef-message"),this.progressBar=r("#qodef-bulk-progressbar"),this.progressBarMaxCount=this.progressBar.length&&void 0!==this.progressBar.data("max")?parseInt(this.progressBar.data("max"),10):0,this.prograssBarCounter=0,this.isProgressBarActive=!1,this.counter=r("#qodef-bulk-counter"),this.resultsHolder=r("#qodef-bulk-results"),this.mainForm.length&&l.initAction(this.mainForm)},initAction:function(p){p.length&&(l.allOptions.on("change",function(){var a=r('input[type="radio"][name="bulk_option[]"]:checked').val(),s=r('input[type="radio"][name="bulk_folders_option[]"]:checked').val();l.ids=l.mainFormParams.media[a].ids,l.idsCount=parseInt(l.mainFormParams.media[a].count,10),isNaN(l.idsCount)&&(l.idsCount=0),l.paths=l.mainFormParams.folders[s].paths,l.pathsCount=parseInt(l.mainFormParams.folders[s].count,10),isNaN(l.pathsCount)&&(l.pathsCount=0),l.progressBarMaxCount=l.idsCount+l.pathsCount,l.progressBar.prop("data-max",l.progressBarMaxCount),l.counter.find("span.qodef-max").text(l.progressBarMaxCount),0<l.progressBarMaxCount?l.mainFormSubmit.prop("disabled",!1):l.mainFormSubmit.prop("disabled",!0)}),p.submit(function(a){a.preventDefault();var s,e,i=document.activeElement.name;0<l.progressBarMaxCount&&(l.mainFormSubmit.prop("disabled",!0),l.loading.removeClass("qodef-hidden"),l.message.addClass("qodef-hidden"),l.resultsHolder.html("").removeClass("qodef-hidden"),l.progressBar.length&&(isNaN(l.progressBarMaxCount)&&(l.progressBarMaxCount=0),l.isProgressBarActive&&(l.progressBar.progressbar("destroy"),l.prograssBarCounter=0,l.counter.find("span.qodef-current").text(l.prograssBarCounter),l.isProgressBarActive=!1),l.progressBar.removeClass("qodef-hidden").progressbar({max:l.progressBarMaxCount,value:l.prograssBarCounter,create:function(a,s){l.isProgressBarActive=!0}}),l.counter.removeClass("qodef-hidden"),r(document).on("ajaxStop",function(){l.mainFormSubmit.prop("disabled",!1),l.loading.addClass("qodef-hidden"),l.message.removeClass("qodef-hidden")})),a=l.ids,s=l.paths,e={qo_nonce:p.data("qo-nonce"),force_optimization:l.forceOptimization.length&&l.forceOptimization.is(":checked")?"yes":"no"},Object.values(a).map(function(a){a=parseInt(a,10),isNaN(a)||(e.id=a,"bulk_optimization"===i&&l.ajaxOptimizeAndWebp(e))}),Object.values(s).map(function(a){""!==a&&(e.path=a,"bulk_optimization"===i)&&l.ajaxFoldersOptimizeAndWebp(e)}))}))},randomNumberGenerator:function(a=1e4,s=99999){return a=parseInt(a,10),s=parseInt(s,10),isNaN(a)&&(a=1e4),isNaN(s)&&(s=99999),Math.floor(Math.random()*(s-a+1))+a},ajaxConvertOptions:function(a){var s={};return r.ajax({type:"POST",async:!1,url:ajaxurl,data:{action:"options_action_get_convert_options",options:a},success:function(a){a=r.parseJSON(a);"success"===a.status&&(s=a.data)}}),s},ajaxOptimizeAndWebp:function(a){var d,o=l.randomNumberGenerator();r.ajax({type:"POST",url:ajaxurl,data:{action:"bulk_action_optimize_and_webp",options:a},success:function(a){var s,a=r.parseJSON(a),e=!1,i=!1,p=!1,t=!1,n=!1;l.resultsHolder.prepend('<div class="qodef-result qodef-item-'+o+' qodef-hidden"></div>'),d=l.resultsHolder.find(".qodef-result.qodef-item-"+o),a.data.params.watermarked_files.length&&(e=a.data.params.watermarked_files.map(a=>a.params.media_size).indexOf("original"),-1!==(s=a.data.params.watermarked_files.map(a=>a.params.media_size).indexOf("scaled")))&&(e=s),a.data.params.optimization_files.length&&(i=a.data.params.optimization_files.map(a=>a.params.media_size).indexOf("original"),-1!==(s=a.data.params.optimization_files.map(a=>a.params.media_size).indexOf("scaled")))&&(i=s),a.data.params.conversion_files.length&&(p=a.data.params.conversion_files.map(a=>a.params.media_size).indexOf("original"),-1!==(s=a.data.params.conversion_files.map(a=>a.params.media_size).indexOf("scaled")))&&(p=s),a.data.params.optimization2_files.length&&(t=a.data.params.optimization2_files.map(a=>a.params.media_size).indexOf("original"),-1!==(s=a.data.params.optimization2_files.map(a=>a.params.media_size).indexOf("scaled")))&&(t=s),a.data.params.webp_files.length&&(n=a.data.params.webp_files.map(a=>a.params.media_size).indexOf("original"),-1!==(s=a.data.params.webp_files.map(a=>a.params.media_size).indexOf("scaled")))&&(n=s),"success"===a.status?(a.data.params.optimization_skipped?(d.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.original_file+"</span></div>"),d.append('<div><span class="qodef-title">Image Source:</span> <span class="qodef-value">Media Library</span></div>'),d.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_result+"</span></div>")):(a.data.params.restoration_success&&d.append('<div><span class="qodef-title">Restoration:</span> <span class="qodef-value">'+a.data.params.restoration_result+"</span></div>"),(a.data.params.watermarked_success&&!1!==e||a.data.params.optimization_success&&!1!==i||a.data.params.conversion_success&&!1!==p||a.data.params.optimization2_success&&!1!==t)&&(a.data.params.conversion_success&&!1!==p?d.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.conversion_files[p].params.file_basename+"</span></div>"):a.data.params.optimization_success&&!1!==i?d.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.optimization_files[i].params.file_basename+"</span></div>"):d.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.original_file+"</span></div>"),d.append('<div><span class="qodef-title">Image Source:</span> <span class="qodef-value">Media Library</span></div>'),a.data.params.watermarked_success&&!1!==e?d.append('<div><span class="qodef-title">Original:</span> <span class="qodef-value">'+a.data.params.watermarked_files[e].params.initial_size+"</span></div>"):a.data.params.optimization_success&&!1!==i?d.append('<div><span class="qodef-title">Original:</span> <span class="qodef-value">'+a.data.params.optimization_files[i].params.initial_size+"</span></div>"):d.append('<div><span class="qodef-title">Original:</span> <span class="qodef-value">'+a.data.params.initial_size+"</span></div>"),a.data.params.watermarked_skipped||(a.data.params.watermarked_success&&!1!==e?d.append('<div><span class="qodef-title">Watermarked:</span> <span class="qodef-value">'+a.data.params.watermarked_files[e].params.filesize+", "+a.data.params.watermarked_files[e].params.result+"</span></div>"):d.append('<div><span class="qodef-title">Watermarked:</span> <span class="qodef-value">'+a.data.params.watermarked_result+"</span></div>")),a.data.params.optimization_success&&!1!==i?d.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_files[i].params.filesize+", "+a.data.params.optimization_files[i].params.result+"</span></div>"):d.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_result+"</span></div>"),a.data.params.conversion_skipped||(a.data.params.conversion_success&&!1!==p?d.append('<div><span class="qodef-title">Conversion:</span> <span class="qodef-value">'+a.data.params.conversion_files[p].params.filesize+", "+a.data.params.conversion_files[p].params.result+"</span></div>"):d.append('<div><span class="qodef-title">Conversion:</span> <span class="qodef-value">'+a.data.params.conversion_result+"</span></div>")),a.data.params.optimization2_skipped||(a.data.params.optimization2_success&&!1!==t?d.append('<div><span class="qodef-title">Compression:</span> <span class="qodef-value">'+a.data.params.optimization2_files[t].params.filesize+", "+a.data.params.optimization2_files[t].params.result+"</span></div>"):d.append('<div><span class="qodef-title">Compression:</span> <span class="qodef-value">'+a.data.params.optimization2_result+"</span></div>"))),a.data.params.webp_skipped||(a.data.params.webp_success&&!1!==n?d.append('<div><span class="qodef-title">WebP:</span> <span class="qodef-value">'+a.data.params.webp_files[n].params.filesize+", "+a.data.params.webp_files[n].params.result+"</span></div>"):d.append('<div><span class="qodef-title">WebP:</span> <span class="qodef-value">'+a.data.params.webp_result+"</span></div>"))),l.prograssBarCounter++,l.progressBar.progressbar({value:l.prograssBarCounter}),l.counter.find("span.qodef-current").text(l.prograssBarCounter)):(d.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.original_file+"</span></div>"),d.append('<div><span class="qodef-title">Image Source:</span> <span class="qodef-value">Media Library</span></div>'),d.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_result+"</span></div>")),a.data.params.elapsed_time&&d.append('<div><span class="qodef-title">Elapsed time:</span> <span class="qodef-value">'+a.data.params.elapsed_time+"</span></div>"),d.removeClass("qodef-hidden")}})},ajaxFoldersOptimizeAndWebp:function(a){var s,e=l.randomNumberGenerator();l.resultsHolder.prepend('<div class="qodef-result qodef-item-'+e+' qodef-hidden"></div>'),s=l.resultsHolder.find(".qodef-result.qodef-item-"+e),r.ajax({type:"POST",url:ajaxurl,data:{action:"bulk_action_folders_optimize_and_webp",options:a},success:function(a){a=r.parseJSON(a);"success"===a.status?(a.data.params.optimization_skipped?(s.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.original_file+"</span></div>"),s.append('<div><span class="qodef-title">Image Source:</span> <span class="qodef-value">Folders</span></div>'),s.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_result+"</span></div>")):(a.data.params.restoration_success&&s.append('<div><span class="qodef-title">Restoration:</span> <span class="qodef-value">'+a.data.params.restoration_result+"</span></div>"),(a.data.params.watermarked_success||a.data.params.optimization_success||a.data.params.conversion_success||a.data.params.optimization2_success)&&(a.data.params.conversion_success?s.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.conversion_files[0].params.file_basename+"</span></div>"):a.data.params.optimization_success?s.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.optimization_files[0].params.file_basename+"</span></div>"):s.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.original_file+"</span></div>"),s.append('<div><span class="qodef-title">Image Source:</span> <span class="qodef-value">Folders</span></div>'),a.data.params.watermarked_success?s.append('<div><span class="qodef-title">Original:</span> <span class="qodef-value">'+a.data.params.watermarked_files[0].params.initial_size+"</span></div>"):a.data.params.optimization_success?s.append('<div><span class="qodef-title">Original:</span> <span class="qodef-value">'+a.data.params.optimization_files[0].params.initial_size+"</span></div>"):s.append('<div><span class="qodef-title">Original:</span> <span class="qodef-value">'+a.data.params.initial_size+"</span></div>"),a.data.params.watermarked_skipped||(a.data.params.watermarked_success?s.append('<div><span class="qodef-title">Watermarked:</span> <span class="qodef-value">'+a.data.params.watermarked_files[0].params.filesize+", "+a.data.params.watermarked_files[0].params.result+"</span></div>"):s.append('<div><span class="qodef-title">Watermarked:</span> <span class="qodef-value">'+a.data.params.watermarked_result+"</span></div>")),a.data.params.optimization_success?s.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_files[0].params.filesize+", "+a.data.params.optimization_files[0].params.result+"</span></div>"):s.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_result+"</span></div>"),a.data.params.conversion_skipped||(a.data.params.conversion_success?s.append('<div><span class="qodef-title">Conversion:</span> <span class="qodef-value">'+a.data.params.conversion_files[0].params.filesize+", "+a.data.params.conversion_files[0].params.result+"</span></div>"):s.append('<div><span class="qodef-title">Conversion:</span> <span class="qodef-value">'+a.data.params.conversion_result+"</span></div>")),a.data.params.optimization2_skipped||(a.data.params.optimization2_success?s.append('<div><span class="qodef-title">Compression:</span> <span class="qodef-value">'+a.data.params.optimization2_files[0].params.filesize+", "+a.data.params.optimization2_files[0].params.result+"</span></div>"):s.append('<div><span class="qodef-title">Compression:</span> <span class="qodef-value">'+a.data.params.optimization2_result+"</span></div>"))),a.data.params.webp_skipped||(a.data.params.webp_success?s.append('<div><span class="qodef-title">WebP:</span> <span class="qodef-value">'+a.data.params.webp_files[0].params.filesize+", "+a.data.params.webp_files[0].params.result+"</span></div>"):s.append('<div><span class="qodef-title">WebP:</span> <span class="qodef-value">'+a.data.params.webp_result+"</span></div>"))),l.prograssBarCounter++,l.progressBar.progressbar({value:l.prograssBarCounter}),l.counter.find("span.qodef-current").text(l.prograssBarCounter)):(s.append('<div class="qodef-file-name"><span class="qodef-title">File:</span> <span class="qodef-value">'+a.data.params.original_file+"</span></div>"),s.append('<div><span class="qodef-title">Image Source:</span> <span class="qodef-value">Folders</span></div>'),s.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_result+"</span></div>")),a.data.params.elapsed_time&&s.append('<div><span class="qodef-title">Elapsed time:</span> <span class="qodef-value">'+a.data.params.elapsed_time+"</span></div>"),s.removeClass("qodef-hidden")}})}}}(jQuery);