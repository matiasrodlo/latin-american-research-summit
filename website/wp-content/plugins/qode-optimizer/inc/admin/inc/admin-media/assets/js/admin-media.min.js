!function(l){"use strict";"object"!=typeof qodefFramework&&(window.qodefFramework={}),l(document).ready(function(){r.init(),"undefined"!=typeof wp&&void 0!==wp.media&&void 0!==wp.media.frame&&wp.media.frame.on("edit:attachment",function(a){var e,a={id:a.id};r.ajaxInitButtonsAndInfoHtml(a).then(function(a){a=l.parseJSON(a);""!==(e=a.data)&&(wp.media.frame.$el.find(".settings").append('<div class="setting qodef-plugin-info" data-setting="qode-optimizer"><div class="name">Qode Optimizer</div><div class="value">'+e+"</div></div>"),r.initAction(wp.media.frame.$el.find(".qodef-media-action-holder")))})})});var r={init:function(){this.qodefMediaMainTable=l(".wp-list-table.media"),this.qodefMediaActionHolder=l(".qodef-media-action-holder"),this.qodefMediaActionHolder.length&&this.qodefMediaActionHolder.each(function(){var a=l(this);r.initAction(a)})},initAction:function(i){var t,n,d;i.length&&(t=i.find(".qodef-media-action-links"),n=i.find(".qodef-media-original-results"),d=i.find(".qodef-media-action-results"),i.on("click",".qodef-media-action-link.qodef-optimize-manual",function(a){a.preventDefault(),a.stopPropagation();var a=l(this),e=i.find(".qodef-spinner-loading"),s={id:a.data("id"),qo_nonce:a.data("qo-nonce")};d.html(""),t.find(".qodef-media-action-link").remove(),e.removeClass("qodef-hidden"),r.ajaxOptimizeProcess(s,d,a,e).then(function(){e.addClass("qodef-hidden").find(".qodef-action-label").text(""),setTimeout(function(){d.addClass("qodef-init")},100),r.ajaxButtons(s,t)})}),i.on("click",".qodef-media-action-link.qodef-restore-manual",function(a){a.preventDefault(),a.stopPropagation();var a=l(this),e=i.find(".qodef-spinner-loading"),s={id:a.data("id"),qo_nonce:a.data("qo-nonce")};d.html(""),t.find(".qodef-media-action-link").remove(),e.removeClass("qodef-hidden"),r.ajaxRestore(s,d,a,e).then(function(){e.addClass("qodef-hidden").find(".qodef-action-label").text(""),r.ajaxButtons(s,t)})}),i.on("click",".qodef-media-action-link.qodef-recover-manual",function(a){a.preventDefault(),a.stopPropagation();var a=l(this),e=i.find(".qodef-spinner-loading"),s={id:a.data("id"),qo_nonce:a.data("qo-nonce")};d.html(""),t.find(".qodef-media-action-link").remove(),e.removeClass("qodef-hidden"),r.ajaxRecover(s,d,a,e).then(function(){e.addClass("qodef-hidden").find(".qodef-action-label").text(""),r.ajaxButtons(s,t)})}),i.on("click",".qodef-media-action-link.qodef-regenerate-manual",function(a){a.preventDefault(),a.stopPropagation();var a=l(this),e=i.find(".qodef-spinner-loading"),s={id:a.data("id"),qo_nonce:a.data("qo-nonce")};d.html(""),t.find(".qodef-media-action-link").remove(),e.removeClass("qodef-hidden"),r.ajaxRegenerate(s,n,d,a,e).then(function(){e.addClass("qodef-hidden").find(".qodef-action-label").text(""),r.ajaxButtons(s,t)})}),i.on("click",".qodef-media-action-link.qodef-add-watermark-manual",function(a){a.preventDefault(),a.stopPropagation();var a=l(this),e=i.find(".qodef-spinner-loading"),s={id:a.data("id"),qo_nonce:a.data("qo-nonce")};d.html(""),t.find(".qodef-media-action-link").remove(),e.removeClass("qodef-hidden"),r.ajaxAddWatermark(s,n,d,a,e).then(function(){e.addClass("qodef-hidden").find(".qodef-action-label").text(""),r.ajaxButtons(s,t)})}))},ajaxShouldBeConverted:function(a){return l.ajax({type:"POST",url:ajaxurl,data:{action:"media_action_should_be_converted",options:a}})},ajaxOptimizeProcess:function(o,p,a,e){return p.removeClass("qodef-init"),e.find(".qodef-action-label").text("Optimizing..."),l.ajax({type:"POST",url:ajaxurl,data:{action:"media_action_optimize_process",options:o},success:function(a){var e,a=l.parseJSON(a),s=!1,i=!1,t=!1,n=!1,d=!1;a.data.params.watermarked_files.length&&(s=a.data.params.watermarked_files.map(a=>a.params.media_size).indexOf("original"),-1!==(e=a.data.params.watermarked_files.map(a=>a.params.media_size).indexOf("scaled")))&&(s=e),a.data.params.optimization_files.length&&(i=a.data.params.optimization_files.map(a=>a.params.media_size).indexOf("original"),-1!==(e=a.data.params.optimization_files.map(a=>a.params.media_size).indexOf("scaled")))&&(i=e),a.data.params.conversion_files.length&&(t=a.data.params.conversion_files.map(a=>a.params.media_size).indexOf("original"),-1!==(e=a.data.params.conversion_files.map(a=>a.params.media_size).indexOf("scaled")))&&(t=e),a.data.params.optimization2_files.length&&(n=a.data.params.optimization2_files.map(a=>a.params.media_size).indexOf("original"),-1!==(e=a.data.params.optimization2_files.map(a=>a.params.media_size).indexOf("scaled")))&&(n=e),a.data.params.webp_files.length&&(d=a.data.params.webp_files.map(a=>a.params.media_size).indexOf("original"),-1!==(e=a.data.params.webp_files.map(a=>a.params.media_size).indexOf("scaled")))&&(d=e),"success"===a.status?(a.data.params.restoration_success&&p.append('<div><span class="qodef-title">Restoration:</span> <span class="qodef-value">'+a.data.params.restoration_result+"</span></div>"),(a.data.params.watermarked_success&&!1!==s||a.data.params.optimization_success&&!1!==i||a.data.params.conversion_success&&!1!==t||a.data.params.optimization2_success&&!1!==n)&&(a.data.params.watermarked_skipped||(a.data.params.watermarked_success&&!1!==s?p.append('<div><span class="qodef-title">Watermarked:</span> <span class="qodef-value">'+a.data.params.watermarked_files[s].params.filesize+", "+a.data.params.watermarked_files[s].params.result+"</span></div>"):p.append('<div><span class="qodef-title">Watermarked:</span> <span class="qodef-value">'+a.data.params.watermarked_result+"</span></div>")),a.data.params.optimization_success&&!1!==i?p.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_files[i].params.filesize+", "+a.data.params.optimization_files[i].params.result+"</span></div>"):p.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_result+"</span></div>"),a.data.params.conversion_skipped||(a.data.params.conversion_success&&!1!==t?(e=r.qodefMediaMainTable.find("#post-"+o.id+" .column-title .filename .screen-reader-text").html(),r.qodefMediaMainTable.find("#post-"+o.id+" .column-title .filename").html('<span class="screen-reader-text">'+e+"</span>"+a.data.params.conversion_files[t].params.file_basename),r.qodefMediaMainTable.find("#post-"+o.id+" .column-title .row-actions .copy button").attr("data-clipboard-text",a.data.params.conversion_files[t].params.url),r.qodefMediaMainTable.find("#post-"+o.id+" .column-title .row-actions .download a").attr("href",a.data.params.conversion_files[t].params.url),p.append('<div><span class="qodef-title">Conversion:</span> <span class="qodef-value">'+a.data.params.conversion_files[t].params.filesize+", "+a.data.params.conversion_files[t].params.result+"</span></div>")):p.append('<div><span class="qodef-title">Conversion:</span> <span class="qodef-value">'+a.data.params.conversion_result+"</span></div>")),a.data.params.optimization2_skipped||(a.data.params.optimization2_success&&!1!==n?p.append('<div><span class="qodef-title">Compression:</span> <span class="qodef-value">'+a.data.params.optimization2_files[n].params.filesize+", "+a.data.params.optimization2_files[n].params.result+"</span></div>"):p.append('<div><span class="qodef-title">Compression:</span> <span class="qodef-value">'+a.data.params.optimization2_result+"</span></div>"))),a.data.params.webp_skipped||(a.data.params.webp_success&&!1!==d?p.append('<div><span class="qodef-title">WebP:</span> <span class="qodef-value">'+a.data.params.webp_files[d].params.filesize+", "+a.data.params.webp_files[d].params.result+"</span></div>"):p.append('<div><span class="qodef-title">WebP:</span> <span class="qodef-value">'+a.data.params.webp_result+"</span></div>"))):p.append('<div><span class="qodef-title">Optimization:</span> <span class="qodef-value">'+a.data.params.optimization_result+"</span></div>"),a.data.params.elapsed_time&&p.append('<div><span class="qodef-title">Elapsed time:</span> <span class="qodef-value">'+a.data.params.elapsed_time+"</span></div>")},complete:function(){console.log("Optimization finished!")}})},ajaxRestore:function(s,i,a,e){return e.find(".qodef-action-label").text("Restoring..."),l.ajax({type:"POST",url:ajaxurl,data:{action:"media_action_restore",options:s},success:function(a){var e,a=l.parseJSON(a);"success"===a.status?(i.append('<div><span class="qodef-title">Restoration:</span> <span class="qodef-value">'+a.data.params.result+"</span></div>"),e=r.qodefMediaMainTable.find("#post-"+s.id+" .column-title .filename .screen-reader-text").html(),r.qodefMediaMainTable.find("#post-"+s.id+" .column-title .filename").html('<span class="screen-reader-text">'+e+"</span>"+a.data.params.data.file_basename),r.qodefMediaMainTable.find("#post-"+s.id+" .column-title .row-actions .copy button").attr("data-clipboard-text",a.data.params.data.url),r.qodefMediaMainTable.find("#post-"+s.id+" .column-title .row-actions .download a").attr("href",a.data.params.data.url)):i.append('<div><span class="qodef-title">Restoration:</span> <span class="qodef-value">'+a.data.params.result+"</span></div>"),a.data.params.elapsed_time&&i.append('<div><span class="qodef-title">Elapsed time:</span> <span class="qodef-value">'+a.data.params.elapsed_time+"</span></div>")},complete:function(){console.log("Restoration Finished!")}})},ajaxRegenerate:function(a,e,s,i,t){return t.find(".qodef-action-label").text("Regenerating..."),l.ajax({type:"POST",url:ajaxurl,data:{action:"media_action_regenerate",options:a},success:function(a){a=l.parseJSON(a);"success"===a.status&&e.find(".qodef-value").html(a.data.params.filesize),s.append('<div><span class="qodef-title">Regeneration:</span> <span class="qodef-value">'+a.data.params.result+"</span></div>"),a.data.params.elapsed_time&&s.append('<div><span class="qodef-title">Elapsed time:</span> <span class="qodef-value">'+a.data.params.elapsed_time+"</span></div>")},complete:function(){console.log("Regeneration Finished!")}})},ajaxAddWatermark:function(a,e,i,s,t){return t.find(".qodef-action-label").text("Adding Watermark..."),l.ajax({type:"POST",url:ajaxurl,data:{action:"media_action_add_watermark",options:a},success:function(a){var e,a=l.parseJSON(a),s=!1;a.data.params.files.length&&(s=a.data.params.files.map(a=>a.params.media_size).indexOf("original"),-1!==(e=a.data.params.files.map(a=>a.params.media_size).indexOf("scaled")))&&(s=e),"success"===a.status&&a.data.params.success&&!1!==s?i.append('<div><span class="qodef-title">Watermarking:</span> <span class="qodef-value">'+a.data.params.files[s].params.filesize+", "+a.data.params.files[s].params.result+"</span></div>"):i.append('<div><span class="qodef-title">Watermarking:</span> <span class="qodef-value">'+a.data.params.result+"</span></div>"),a.data.params.elapsed_time&&i.append('<div><span class="qodef-title">Elapsed time:</span> <span class="qodef-value">'+a.data.params.elapsed_time+"</span></div>")},complete:function(){console.log("Adding Watermark Finished!")}})},ajaxRecover:function(s,i,a,e){return e.find(".qodef-action-label").text("Trying to recover..."),l.ajax({type:"POST",url:ajaxurl,data:{action:"media_action_recover",options:s},success:function(a){var e,a=l.parseJSON(a);"success"===a.status?(i.append('<div><span class="qodef-title">Recover:</span> <span class="qodef-value">'+a.data.params.result+"</span></div>"),e=r.qodefMediaMainTable.find("#post-"+s.id+" .column-title .filename .screen-reader-text").html(),r.qodefMediaMainTable.find("#post-"+s.id+" .column-title .filename").html('<span class="screen-reader-text">'+e+"</span>"+a.data.params.data.file_basename),r.qodefMediaMainTable.find("#post-"+s.id+" .column-title .row-actions .copy button").attr("data-clipboard-text",a.data.params.data.url),r.qodefMediaMainTable.find("#post-"+s.id+" .column-title .row-actions .download a").attr("href",a.data.params.data.url)):i.append('<div><span class="qodef-title">Recover:</span> <span class="qodef-value">'+a.data.params.result+"</span></div>"),a.data.params.elapsed_time&&i.append('<div><span class="qodef-title">Elapsed time:</span> <span class="qodef-value">'+a.data.params.elapsed_time+"</span></div>")},complete:function(){console.log("Recover Finished!")}})},ajaxInitButtonsAndInfoHtml:function(a){return l.ajax({type:"POST",url:ajaxurl,data:{action:"media_init_action_buttons_and_info",options:a}})},ajaxButtons:function(a,e){return l.ajax({type:"POST",url:ajaxurl,data:{action:"media_include_action_buttons",options:a},success:function(a){a=l.parseJSON(a);"success"===a.status&&e.prepend(a.data)}})}};qodefFramework.qodefMedia=r}(jQuery);